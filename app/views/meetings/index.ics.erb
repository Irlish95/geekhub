<%
require 'icalendar'
require 'date'


cal = Icalendar::Calendar.new


cal.add_x_wr_caldesc('Geekhub')
cal.add_x_wr_calname('Geekhub')
cal.add_x_wr_timezone('Europe/Copenhagen')

@meetings.each do |m|
  e = Icalendar::Event.new
  e.summary m.title
  e.dtstart     m.starts_at.to_datetime
  e.dtend       (m.starts_at + 3.hours).to_datetime
  e.location    m.city.name
  e.description m.description + "\n\nLÃ¦s mere: " + m.url.gsub(';', "\\;")
  e.url         m.url
  e.alarm do
    description m.title
  end
  cal.add_event(e)
end
%>
<%= raw cal.to_ical %>